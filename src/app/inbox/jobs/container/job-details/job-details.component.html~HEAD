<div *ngIf="!job" class="container d-flex h-100 flex-column justify-content-center" style="min-height: 640px;">
  <img src="assets/img/loader.svg" height="36px" alt="Loader">
</div>

<div class="container" *ngIf="job">
  <div class="row" *ngIf="false">
    <span class="col-6 text-left">
      <h4 class="fw-500 mb-30">MANAGE JOB</h4>
    </span>
    <span class="col-6 text-right">
      <button class="btn">Click me</button>
    </span>
  </div>
  <div class="card mb-30 p-30 job-detail-card">
    <div id="job-top" class="row">
      <div class="col-lg-8 col-md-7 col-sm-9 col-xs-12">
        <div class="row">
            <span class="col-lg-2 col-md-3 col-sm-3 col-xs-4">
                <img *ngIf="job.otherParty?.avatar && job.otherParty?.avatar?.uri" class="headshot" src="{{ job.otherParty?.avatar.uri }}"
                  alt="">
              </span>
              <span class="col-lg-10 col-md-9 col-sm-9 col-xs-8 text-left">
                <div class="row">
                  <h3 class="col-12">{{job.information.title}}</h3>
                </div>
                <div class="row">
                  <span class="card-subtitle col-8">
                    <h4 class="fw-500">{{job.otherParty?.name}}</h4>
                  </span>
                </div>
              </span>
        </div>
      </div>
      <span class="col-lg-4 col-md-5 col-sm-3 col-xs-12" id="status-span">
        <div class="row">
          <div class="col-12">
            <!-- Current state -->
            <app-status-icon [job]="job"></app-status-icon>
          </div>
        </div>
      </span> 
    </div>   
    <div id="job-actions" class="my-10"> 
        <div>
            <div class="row">
             <div class="col-lg-4 col-md-3 col-sm-12">
              <b>Actions</b>
             </div>
             <div *ngIf="availableActions.length > 0" class="col-lg-8 col-md-9 col-sm-12 action-group">  
                <button *ngFor="let action of availableActions" class="btn action-btn  btn-{{getActionColour(action)}} btn-outline btn-sm" (click)="executeAction(action)">
                 {{action}}
                </button>
             </div> 
             <div *ngIf="availableActions.length < 1" class="col-lg-8 col-md-9 col-sm-12 action-group">  
                  <i>No actions available</i>
             </div>  
            </div> 
        </div> 
      </div>
    <div id="job-description" class="row">
        <div class="col-12">
          <br>
          <div class="mb-10"> 
          <b>Job description</b>
          {{job.information.description}}
          </div>
          <div class="mb-10">
            <b>Budget:</b>
            <app-budget [job]="job"></app-budget>
          </div>  
        </div>
      </div>
    <div id="job-details" class="row my-10">
        <div class="col-lg-6 col-md-12">
            <app-property [property]="'Initial Stage'" [value]="job.information.initialStage"></app-property>
            <app-property [property]="'Work type'" [value]="job.information.workType"></app-property>
            <app-property [property]="'Timeline expectation'" [value]="job.information.timelineExpectation"></app-property>
            <app-property [property]="'Weekly commitment'" [value]="job.information.weeklyCommitment  + ' hours'"></app-property>    
        </div>
        <div class="col-lg-6 col-md-12">
            <div id="attachments-row" class="row">
              <div class="col-lg-3 col-md-4 col-sm-6 col-xs-12"> 
                  <b>Attachments</b> 
              </div>
              <div class="col-lg-9 col-md-8 col-sm-6 col-xs-12">
                  <app-attachment *ngFor="let attachment of job.information.attachments" [name]="attachment.name" [url]="attachment.url" [size]="attachment.size"></app-attachment>
              </div>
            </div> 
             <div id="skills-row" class="row">
               <div class="col-lg-3 col-md-4  col-sm-6 col-xs-12"> 
                <b>Skills Required</b> 
               </div>
               <div class="col-lg-9 col-md-8 col-sm-6 col-xs-12"> 
                  <app-skill-tag *ngFor="let skill of job.information.skills" [skill]="skill"></app-skill-tag>
               </div> 
            </div>
        </div>


    </div> 
    <div id="job-logs" class="row my-10">   
      <div class="col-12 my-10 text-left">
        <b>Action Log</b>
        <div *ngFor="let action of job.actionLog | orderBy:'timestamp':true" class="my-10">
          <div class="row" *ngIf="!action.private || action.executedBy == currentUserType">
            <div class="col-lg-8 col-md-6  col-sm-6 col-xs-6">
                {{action.type}} by {{getActionExecutor(action)}}
            <p *ngIf="action.data">Message: {{action.data}}</p>
            </div>
            <div class="col-lg-4 col-md-6  col-sm-6 col-xs-6 text-right"> 
            {{action.timestamp | date:'medium'}}
            </div> 
          </div>
        </div>
        <!-- <a class="btn btn-primary btn-outline" [routerLink]="['actions']">View all actions</a> -->
      </div>
      <span class="col-12 my-10 text-left">
        <b>Payment Log</b>
        <div *ngIf="job.paymentLog.length < 1">
          No payments have been made yet
        </div>
      </span>
    </div>
  </div>
</div>
