
<div *ngIf="loading" class="container d-flex h-50 flex-column justify-content-center" style="min-height: 640px;">
    <img src="assets/img/loader.svg" height="36px" alt="Loader">
</div>

<div *ngIf="!paymentMethod && !loading" class="container">
  <div class="row">
    <div class="col-12 text-center choose-payment">
      <h2>Choose your payment method</h2>
      <button class="btn-payment-type" (click)="setPaymentMethod('fiat')"><img src="assets/img/credit-card.svg"><br>Pay
        with<br>Credit card</button>
      <button class="btn-payment-type" (click)="setPaymentMethod('crypto'); startCanpay() "><img src="assets/img/ethereum.svg"><br>Pay
        with<br>Cryptocurrency</button>
    </div>
  </div>
</div>

<div *ngIf="paymentMethod == 'fiat' && error" class="container">
  <div class="row">
    <div class="col-12 text-center choose-payment">
      Uh-oh.. something went wrong
    </div> 
  </div>
</div>

<div *ngIf="paymentMethod == 'fiat' && !loading && !error" class="container choose-payment">
  <div class="row">
    <h2 class="col-12 text-center">Paying With Credit Card</h2>
    <div class="col-sm-8 offset-sm-2 col-12 text-center createWallet" *ngIf="fiatPaymentStep === 0">
      <h4>
        Generate Wallet
      </h4>
      <br>
      <p>We will now create a crypto wallet, allowing you to pay and interact with the ethereum blockchain easily using
        your credit card.</p>
      <p class="text-danger">You <b>MUST</b> remember this password. If you lose this password, you <b>WILL</b> lose
        access to your funds.</p>
      <div class="col-sm-4 offset-sm-4">
        <form [formGroup]="walletForm" class="form validate" novalidate>
          <div class="form-group">
            <label for="password">Password:</label>
            <input type="password" #password formControlName="password" required class="form-control" id="password"
              [class.invalid]="!walletForm.controls.password.valid && walletForm.controls.password.dirty">
          </div>
        </form>
      </div>
      <button (click)="paymentMethod = null" class="btn btn-danger m-5">Cancel</button>
      <button [disabled]="!walletForm.valid" class="btn btn-primary m-5" data-toggle="modal" data-target="#savePassword">Get
        Wallet</button>
    </div>
    <div class="col-sm-8 offset-sm-2 col-12 text-center createWallet" *ngIf="fiatPaymentStep === 1">
      <h4>
        Generating Wallet
      </h4>
      <br>
      <img src="assets/img/loader.svg" height="36px" alt="Loader">
      <p>
        Your wallet is being generated. Please wait...
      </p>
      <br>
    </div>

    <div class="col-sm-8 offset-sm-2 col-12 text-center createWallet" *ngIf="fiatPaymentStep === 2">
      <h4>
        Unlock Wallet
      </h4>
      <br>
      <p>We have detected that you have paid with a credit card before. To do it again, please the password you used
        last time.</p>
      <div class="col-sm-4 offset-sm-4">
        <form [formGroup]="walletForm" class="form validate" novalidate>
          <div class="form-group">
            <label for="password">Password:</label>
            <input type="password" #password formControlName="password" required class="form-control" id="password"
              [class.invalid]="!walletForm.controls.password.valid && walletForm.controls.password.dirty">
          </div>
        </form>
      </div>
      <button (click)="paymentMethod = null" class="btn btn-danger m-5">Cancel</button>
      <button [disabled]="!walletForm.valid" class="btn btn-primary m-5" (click)="unlockWallet()">Get
        Wallet</button>
    </div>
  </div>
</div>

<div id="savePassword" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-body text-center">
        <h4>Have you saved your password?</h4>
        <hr>
        <p>You must save your password securely.<br><b>LOSING THIS PASSWORD MEANS LOSING YOUR FUNDS.</b><br>If you lose
          this password, you will not be able to : </p>
        <ul class="list-unstyled text-danger">
          <li>
            Access your funds in the escrow
          </li>
          <li>
            Pay the provider & release the funds from the escrow
          </li>
          <li>
            Get your funds back from the escrow
          </li>
        </ul>
      </div>
      <div class="text-center p-15">
        <button class="btn btn-danger btn-175 m-5" data-dismiss="modal">Not yet</button>
        <button (click)="createWallet()" [disabled]="!walletForm.valid" class="btn btn-primary btn-175 m-5"
          data-dismiss="modal">Create Wallet</button>
      </div>
    </div>
  </div>
</div>

<div *ngIf="paymentMethod == 'crypto'">
  <div *ngIf="!canPayOptions" class="container d-flex h-100 flex-column justify-content-center" style="min-height: 640px;">
    <img src="assets/img/loader.svg" height="36px" alt="Loader">
  </div>
  <div class="container" *ngIf="canPayOptions ">
    <canyalib-canpay [dAppName]="canPayOptions.dAppName" [successText]="canPayOptions.successText" [operation]="canPayOptions.operation"
      [onAuthTxHash]="canPayOptions.onAuthTxHash" [recipient]="canPayOptions.recipient" [amount]="canPayOptions.amount"
      [paymentSummary]="canPayOptions.paymentSummary" [postAuthorisationProcessName]="canPayOptions.postAuthorisationProcessName"
      [postAuthorisationProcessResults]="canPayOptions.postAuthorisationProcessResults" (startPostAuthorisationProcess)="canPayOptions.startPostAuthorisationProcess($event)"
      (complete)="canPayOptions.complete($event)" (cancel)="canPayOptions.cancel($event)" [disableCanEx]="canPayOptions.disableCanEx"
      [userEmail]="canPayOptions.userEmail"></canyalib-canpay>
  </div>
</div>
