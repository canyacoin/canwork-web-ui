<main class="main-content">
  <section class="section bg-gray pt-15 pb-20">
    <app-back-button></app-back-button>
    <div *ngIf="!job && loading" class="container d-flex h-100 flex-column justify-content-center" style="min-height: 640px;">
      <img src="assets/img/loader.svg" height="36px" alt="Loader">
    </div>
    <div class="container job-detail-container" *ngIf="job">
      <div class="card p-30 job-detail-card" *ngIf="canSee">
        <div class="container">
          <div class="row">
            <div class="col-lg-9 col-12">
              <h5 class="fw-600 mb-0">JOB DETAILS</h5>
              <h2>
                {{job.information.title}}
              </h2>
              <div class="" style="max-width: 65vw; min-height: 5rem">
                <p>
                  {{job.information.description.substring(0, 80)}}
                  <span *ngIf="hideDescription === false">
                    {{job.information.description.substring(80, job.information.description.length)}}
                  </span>
                  <a class="pointer text-blue" *ngIf="job.information.description.length > 80" (click)="toggleDescription()">
                    <span *ngIf="hideDescription">
                      ...Show more
                    </span>
                    <span *ngIf="!hideDescription">
                      <br>
                      Show less
                    </span>
                  </a>
                </p>
              </div>
            </div>
            <div class="col-lg-3 col-12 job-info">
              <a data-toggle="modal" data-target="#shareModal" class="share-link">
                <i class="fas fa-share-alt"></i> SHARE
              </a>
              <div class="info-details">
                <b>${{job.budget}}<span *ngIf="job.paymentType !== 'Fixed price'">/hr</span> USD</b>
                <p>{{job.paymentType}}</p>
              </div>
              <div class="info-details">
                <b>{{job.deadline}}</b>
                <p>Deadline</p>
              </div>
              <div class="info-details">
                <b>{{job.information.weeklyCommitment}} hr/week</b>
                <p>Weekly Commitment</p>
              </div>
              <div class="info-details" *ngIf="job.information.attachments.length > 0">
                <b>Attachments</b>
                <a href="{{job.information.attachments[0].url}}" target="_blank">
                  <p>
                    <i class="fas fa-paperclip"></i> {{ job.information.attachments[0].name }}
                  </p>
                </a>
              </div>
            </div>
            <div class="col-12">
              <app-skill-tag *ngFor="let skill of job.information.skills" [skill]=skill></app-skill-tag>
            </div>
          </div>
        </div>
      </div>
      <div class="container p-30 job-actions-card">
        <div class="row">
          <div class="col-12">
            <h5>PROPOSED TERMS</h5>
            <div class="otherPartyName pointer" [routerLink]="['/profile/alt/', job.clientId]">
              <span *ngIf="jobPoster?.avatar && jobPoster?.avatar.uri" class="headshot-div" [ngStyle]="{ 'background-image': 'url(' + jobPoster?.avatar.uri + ')'}">
              </span>
              <p style="font-style: 21px;">{{jobPoster?.name}}</p>
            </div>
            <b>${{job.budget}}<span *ngIf="job.paymentType !== 'Fixed price'">/hr</span> USD</b>
            <p>This project is set at a {{job.paymentType}}, {{job.information.weeklyCommitment}} hours per week, over
              {{job.information.timelineExpectation}} period.</p>
            <hr>
          </div>
          <div class="col-12" *ngIf="currentUser.type === 'Provider' && !myJob">
            <button class="btn btn-primary mt-5 mr-5" data-toggle="modal" data-target="#bidModal">
              PLACE BID
            </button>
          </div>
        </div>
      </div>
    </div>
    <div class="container job-detail-container" *ngIf="job && !canSee && !loading">
      <div class="card p-30 job-detail-card">
        <div class="container">
          <div class="row">
            <div class="col-12 text-center">
              <h2>We can't find the job you were looking for</h2>
              <p>Please check the link you provided</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</main>
<!-- Modals -->
<div id="shareModal" class="modal fade" *ngIf="job" role="dialog">
  <div border-none class="modal-dialog">
    <!-- Modal content-->
    <div class="modal-content">
      <div border-none class="modal-header  text-center">
        <div class="col-12">
          <h5 class="modal-title">SHARE THIS JOB AS A LINK</h5>
        </div>
        <button type="button" class="close" style="position: absolute; right: 15px;" data-dismiss="modal">&times;</button>
      </div>
      <div border-none class="modal-body">
        <div class="container">
          <div class="row">
            <div class="col-12">
              <div class="row px-15">
                <span>URL:</span>
              </div>
              <div class="row px-15">
                <div class="col-8 link-col">
                  <p *ngIf="!job.friendlyUrl">
                    {{shareableLink}}/jobs/{{job.id}}
                  </p>
                  <p *ngIf="job.friendlyUrl">
                    {{shareableLink}}/jobs/public/{{job.friendlyUrl}}
                  </p>
                </div>
                <div class="col-4">
                  <button (click)="copyLink()" class="btn btn-primary">COPY LINK</button>
                </div>
              </div>
              <div class="row">
                <div class="col-12 text-center">
                  <small id="copied">Copied!</small>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div id="bidModal" *ngIf="job && currentUser.type === 'Provider'" class="modal fade" role="dialog">
  <div border-none class="modal-dialog">
    <!-- Modal content-->
    <div class="modal-content">
      <div border-none class="modal-header  text-center">
        <div class="col-12">
          <h5 class="modal-title">PLACE YOUR BID</h5>
        </div>
        <button type="button" class="close" style="position: absolute; right: 15px;" data-dismiss="modal">&times;</button>
      </div>
      <div border-none class="modal-body">
        <div class="container" *ngIf="canBid">
          <div class="row">
            <div class="col-12">
              <form [formGroup]="bidForm" class="form validate" novalidate>
                <label for="price">Price*</label>
                <br>
                <div class="input-group" style="border: none;">
                  <input type="number" formControlName="price" style="border: 1px solid #ebebeb;" class="form-control" id="price" placeholder="{{job.budget}}">
                  <div class="input-group-append" style="padding: 5px;">
                    <span class="input-group-text">USD <span *ngIf="job.paymentType !== 'Fixed price'">/hr</span></span>
                  </div>
                </div>
                <label for="message">Message</label>
                <br>
                <textarea rows="2" class="form-control" formControlName="message" id="message"></textarea>
              </form>
              <div class="row px-15">
              </div>
              <div class="row">
                <div class="col-12 text-center">
                  <small id="copied">Copied!</small>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="container" *ngIf="!canBid">
          <h6>You've already placed your bid</h6>
        </div>
      </div>
      <div class="modal-footer text-right" *ngIf="canBid">
        <button type="button" class="btn btn-primary" [disabled]="!bidForm.valid" (click)="submitBid()">PLACE BID</button>
      </div>
    </div>
  </div>
</div>
