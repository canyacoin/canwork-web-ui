<main class="font-sans">
  <div class="flex justify-center bg-G50">
    <!-- template start -->
    <div class="max-w-[1440px] w-full py-[56px] px-[24px] md:px-[64px]">
      <div
        *ngIf="job"
        class="flex flex-col md:flex-row md:justify-between gap-[8px] md:gap-[24px] pt-[56px]"
      >
        <div
          *ngIf="job && canSee"
          class="w-full rounded-[12px] bg-white border border-G200 p-11"
        >
          <div class="text-h6 md:text-h5 text-G800 font-medium leading-[1.2]">
            Job Details
          </div>
          <div
            class="text-h4 md:text-h3 text-G800 font-medium leading-[1.2] mt-3"
          >
            {{ job.information.title }}
          </div>
          <div class="text-b3 md:text-b2 text-G800 leading-[1.2] mt-[12px]">
            Posted {{ jobFromNow }}
          </div>
          <div
            class="text-b2 md:text-b1 text-G800 leading-[1.2] mt-[15px]"
            [innerHTML]="job.information.description | linkify"
          ></div>
          <hr
            *ngIf="job.information.skills.length > 0"
            class="h-[1.5px] my-[20px] bg-gray-200 border-0"
          />
          <div
            *ngIf="job.information.skills.length > 0"
            class="text-b2 md:text-b1 text-G800 leading-[1.2] mt-[15px]"
          >
            <app-skill-tag
              *ngFor="let skill of job.information.skills"
              [routerLink]="['/search/']"
              [queryParams]="{ query: skill }"
              [skill]="skill"
            ></app-skill-tag>
          </div>
          <hr
            *ngIf="job.information.attachments.length > 0"
            class="h-[1.5px] my-[20px] bg-gray-200 border-0"
          />
          <div
            *ngIf="job.information.attachments.length > 0"
            class="text-b2 md:text-b1 text-G800 leading-[1.2] mt-[15px]"
          >
            <p class="mb-[10px]">Attachments</p>
            <a href="{{ job.information.attachments[0].url }}" target="_blank">
              <p *ngIf="job.information.attachments[0].name.length > 10">
                <i class="fas fa-paperclip"></i>
                {{ job.information.attachments[0].name.substring(0, 10) }}...
              </p>
              <p *ngIf="job.information.attachments[0].name.length <= 10">
                <i class="fas fa-paperclip"></i>
                {{ job.information.attachments[0].name }}
              </p>
            </a>
          </div>
        </div>
        <div
          class="md:w-[400px] rounded-[12px] bg-white border border-G200 px-7 py-[32px]"
        >
          <div
            class="text-b1 md:text-h6 text-G800 font-medium leading-[1.2] pl-[2px]"
          >
            <span *ngIf="job.state && isOpen && !job.draft">
              <i class="circle-success fas fa-circle mr-[12px]"></i
              >{{ job.state }}
            </span>

            <span *ngIf="job.state && !isOpen && !job.draft">
              <i class="circle-danger fas fa-circle mr-[12px]"></i>Job closed
            </span>

            <span *ngIf="job.draft">
              <i class="circle-danger fas fa-circle mr-[12px]"></i>Draft
            </span>

            <a
              data-toggle="modal"
              data-target="#shareModal"
              *ngIf="!job.draft"
              (click)="createLink()"
              class="float-right hover:cursor-pointer"
            >
              <i class="fas fa-share-alt"></i>
            </a>
          </div>
          <table
            class="table-auto text-b2 md:text-b1 w-full mt-3 border-separate border-spacing-x-[2px] border-spacing-y-[10px]"
          >
            <tr>
              <td class="text-G700">{{ job.paymentType }}</td>
              <td class="text-G900 text-right font-medium">
                ${{ job.budget
                }}<span *ngIf="job.paymentType !== 'Fixed price'">/hr</span> USD
              </td>
            </tr>
            <tr *ngIf="bids">
              <td class="text-G700">Proposals</td>
              <td class="text-G900 text-right font-medium">
                {{ bids.length }} Proposals
              </td>
            </tr>
            <tr>
              <td class="text-G700">Deadline</td>
              <td class="text-G900 text-right font-medium">
                {{ job.deadline }}
              </td>
            </tr>
            <tr *ngIf="job.information.weeklyCommitment > 0">
              <td class="text-G700">Estimated hours</td>
              <td class="text-G900 text-right font-medium">
                {{ job.information.weeklyCommitment }} hours
              </td>
            </tr>
            <tr>
              <td class="text-G700">Category</td>
              <td class="text-G900 text-right font-medium">Software</td>
            </tr>
          </table>
          <hr class="h-[1.5px] my-[20px] bg-gray-200 border-0" />
          <div class="text-b3 md:text-b2 text-G800 leading-[1.2] mt-[12px]">
            About the Client
          </div>
          <div *ngIf="jobPoster" class="mt-[12px]">
            <profile-card
              [index]="0"
              [avatarUri]="jobPoster.avatarUri"
              [name]="jobPoster.name"
              [title]="jobPoster.title"
              [isVerified]="jobPoster.verified"
              [rating]="jobPoster.rating"
              [skillTags]="jobPoster.skillTags"
              [slug]="jobPoster.slug"
              [address]="jobPoster.address"
              [timezone]="jobPoster.timezone"
              [hourlyRate]="jobPoster.hourlyRate"
              [isGrid]="false"
              [isSmall]="true"
            />
          </div>
          <div
            *ngIf="myJob && !isClosed"
            class="text-b3 md:text-b2 text-G800 leading-[1.2] mt-[16px]"
          >
            <button
              class="btn btn-sm btn-primary mt-10 mr-10 w-full text-[15px] py-[7px] normal-case"
              [routerLink]="['/inbox/job/edit', job.id]"
            >
              Edit Job
            </button>
            <button
              class="btn btn-sm btn-danger mt-10 w-full text-[15px] py-[7px] normal-case"
              (click)="cancelJob()"
            >
              Cancel Job
            </button>
          </div>

          <div
            class="text-b3 md:text-b2 text-G800 leading-[1.2] mt-[16px]"
            *ngIf="
              currentUser && currentUser.type === 'Provider' && !myJob && isOpen
            "
          >
            <button
              class="btn btn-sm btn-dark mt-10 mr-10 w-full text-[15px] py-[7px] normal-case"
              [hidden]="!canBid"
              data-toggle="modal"
              data-target="#bidModal"
              [disabled]="!currentUser.bscAddress"
            >
              Apply Now
            </button>
            <i *ngIf="!canBid">You've posted your bid.</i>
            <i *ngIf="!currentUser.bscAddress"
              >To make a bid fill the field "BNB Chain Address field" in the
              <a href="/profile?editProfile=1">profile</a></i
            >
          </div>
        </div>
      </div>
      <div
        *ngIf="job && myJob"
        class="flex flex-col md:flex-row md:justify-between gap-[8px] md:gap-[24px] pt-[32px]"
      >
        <!-- bids start -->

        <div class="w-full rounded-[12px] bg-white border border-G200 p-11">
          <!--<div class="card p-30 job-detail-card">-->
          <div class="container">
            <div class="row">
              <div class="col-sm-8 col-6">
                <h5>BIDS</h5>
              </div>
              <div class="col-sm-4 col-6 text-right">
                <button
                  class="btn btn-sm btn-primary"
                  *ngIf="bids && bids.length > 0"
                  [routerLink]="['bids']"
                >
                  VIEW ALL
                </button>
              </div>
            </div>
            <div class="row" *ngIf="bids">
              <div class="col-12" *ngIf="bids.length !== null">
                <p><b>Total Bid(s) : </b>{{ bids.length }}</p>
              </div>
              <div class="col-12">
                <h6 class="fw-600 ls-2">RECENT BIDS</h6>
              </div>
            </div>
            <div class="row">
              <div class="col-12 text-center" *ngIf="!bids">
                <img
                  src="assets/img/loader.svg"
                  style="height: 36px"
                  alt="Loader"
                />
              </div>
              <div class="col-12" *ngIf="bids && bids.length > 0">
                <div class="row my-10">
                  <div class="col-sm-3 col-6">
                    <b>Provider</b>
                  </div>
                  <div class="col-sm-3 col-6">
                    <b>Bid</b>
                  </div>
                  <div class="col-sm-6 hide-mobile">
                    <b>Message</b>
                  </div>
                </div>
                <div class="row" *ngFor="let bid of bids; let i = index">
                  <div class="col-sm-3 col-6">
                    <p
                      class="fs-16"
                      [routerLink]="['/profile/alt/', bid.providerId]"
                    >
                      {{ bid.providerInfo.name }}
                    </p>
                  </div>
                  <div class="col-sm-3 col-6 mt-5">
                    {{ bid.budget
                    }}<span *ngIf="job.paymentType !== 'Fixed price'">/hr</span>
                    USD
                  </div>
                  <div class="col-sm-6 mt-5 hide-mobile">
                    {{ bid.message.substring(0, 50)
                    }}<span *ngIf="bid.message.length > 50">...</span>
                  </div>
                </div>
              </div>
              <div class="col-12" *ngIf="bids && bids.length < 1">
                <p>No bids yet.</p>
              </div>
            </div>
          </div>
          <!-- </div> -->
        </div>
      </div>
      <!-- bids end -->
    </div>
  </div>
  <!-- template end -->

  <!-- old to remove later -->
  <div class="max-w-[1440px] w-full py-[56px] px-[24px] md:px-[64px] mt-100px">
    <section class="section bg-gray pt-15 pb-20" style="min-height: 70vh">
      <app-back-button></app-back-button>
      <!--<div *ngIf="!job && loading" class="container">
        <div class="row">
          <div class="col-12 job-detail-container text-center">
            <div class="card p-30 job-detail-card">
              <img
                src="assets/img/loader.svg"
                style="height: 36px"
                alt="Loader"
              />
            </div>
          </div>
        </div>
      </div>-->
      <div class="container job-detail-container" *ngIf="job && canSee">
        <!--<div class="card p-30 job-detail-card">
          <div class="container">-->
        <!--<div class="row">
              <div class="col-lg-9 col-12">
                <h5 class="fw-600 mb-0">JOB DETAILS</h5>
                <h2>
                  {{ job.information.title }}
                </h2>
                <div class="" style="max-width: 65vw; min-height: 5rem">
                  <p
                    style="white-space: pre-wrap"
                    [innerHTML]="job.information.description | linkify"
                  ></p>
                </div>
              </div>
              <div class="col-lg-3 col-12 job-info">
                <a
                  data-toggle="modal"
                  data-target="#shareModal"
                  *ngIf="!job.draft"
                  (click)="createLink()"
                  class="share-link"
                >
                  <i class="fas fa-share-alt"></i> SHARE
                </a>
                <div class="info-details">
                  <b
                    >${{ job.budget
                    }}<span *ngIf="job.paymentType !== 'Fixed price'">/hr</span>
                    USD</b
                  >
                  <p>{{ job.paymentType }}</p>
                </div>
                <div class="info-details">
                  <b>{{ job.deadline }}</b>
                  <p>Deadline</p>
                </div>
                <div
                  class="info-details"
                  *ngIf="job.information.weeklyCommitment > 0"
                >
                  <b>{{ job.information.weeklyCommitment }} hrs</b>
                  <p>Total hours</p>
                </div>
                <div class="info-details">
                  <b>Attachments</b>
                  <a
                    href="{{ job.information.attachments[0].url }}"
                    target="_blank"
                    *ngIf="job.information.attachments.length > 0"
                  >
                    <p *ngIf="job.information.attachments[0].name.length > 10">
                      <i class="fas fa-paperclip"></i>
                      {{
                        job.information.attachments[0].name.substring(0, 10)
                      }}...
                    </p>
                    <p *ngIf="job.information.attachments[0].name.length <= 10">
                      <i class="fas fa-paperclip"></i>
                      {{ job.information.attachments[0].name }}...
                    </p>
                  </a>
                  <p>
                    <i *ngIf="job.information.attachments.length < 1"
                      >No attachment provided</i
                    >
                  </p>
                </div>
              </div>
            </div>-->
        <!--<div class="row my-15">-->
        <!--
              <div class="col-md-9 col-sm-8">
                <app-skill-tag
                  *ngFor="let skill of job.information.skills"
                  [routerLink]="['/search/']"
                  [queryParams]="{ query: skill }"
                  [skill]="skill"
                ></app-skill-tag>
              </div>
              -->
        <!--<div class="col-md-3 col-sm-4" *ngIf="myJob && !isClosed">
                <button
                  class="btn btn-sm btn-primary mt-10 mr-10"
                  [routerLink]="['/inbox/job/edit', job.id]"
                >
                  EDIT JOB
                </button>
                <button
                  class="btn btn-sm btn-danger mt-10"
                  (click)="cancelJob()"
                >
                  CANCEL JOB
                </button>
              </div>-->
        <!--</div>-->
        <!-- </div>
        </div>-->
        <div class="container p-30 job-actions-card">
          <div class="row">
            <!--<div class="col-sm-8">
              <h5>PROPOSED TERMS</h5>
            </div>
            <div class="col-sm-4 text-right text-left-mobile">
              <div class="status-div" *ngIf="job.state && isOpen && !job.draft">
                <span class="jobStatus">
                  <i class="circle-success fas fa-circle"></i>&nbsp;
                  {{ job.state }}
                </span>
              </div>
              <div
                class="status-div"
                *ngIf="job.state && !isOpen && !job.draft"
              >
                <span class="jobStatus">
                  <i class="circle-danger fas fa-circle"></i>&nbsp; Job closed
                </span>
              </div>
              <div class="status-div" *ngIf="job.draft">
                <span class="jobStatus">
                  <i class="circle-danger fas fa-circle"></i>&nbsp; Draft
                </span>
              </div>
            </div>-->
            <!--<div class="col-12">
              <div
                class="otherPartyName pointer"
                [routerLink]="['/profile/alt/', job.clientId]"
              >
                <app-avatar
                  [user]="jobPoster"
                  [customClass]="'headshot-div'"
                ></app-avatar>
                <p style="font-style: 21px">
                  {{ jobPoster?.name
                  }}<app-verified-mark [user]="jobPoster"></app-verified-mark>
                </p>
              </div>
              <b
                >${{ job.budget
                }}<span *ngIf="job.paymentType !== 'Fixed price'">/hr</span>
                USD</b
              >
              <p>
                This project is set at a {{ job.paymentType.toLowerCase()
                }}<br />
                  {{ job.information.weeklyCommitment }}
                  hours per week, over
                  {{ job.information.timelineExpectation }} period.
              </p>
              <hr
                *ngIf="
                  currentUser &&
                  currentUser.type === 'Provider' &&
                  !myJob &&
                  isOpen
                "
              />
            </div>-->
            <!--<div class="col-12" *ngIf="bids">
              <p><b>Total Bid(s) : </b>{{ bids.length }}</p>
            </div>-->
            <div
              class="col-12"
              *ngIf="
                currentUser &&
                currentUser.type !== 'Provider' &&
                !myJob &&
                isOpen
              "
            >
              <span
                >You must be a CanWork service provider to bid on this
                job.</span
              >
            </div>
            <div class="col-12" *ngIf="!currentUser && !myJob && isOpen">
              <span
                >Sign up to be a CanWork service provider to bid on this job.
                <a [routerLink]="['/auth']">Create one now.</a></span
              >
            </div>
          </div>
        </div>
      </div>
      <div
        class="container job-detail-container"
        *ngIf="job && !canSee && !loading"
      >
        <div class="card p-30 job-detail-card">
          <div class="container">
            <div class="row">
              <div class="col-12 text-center">
                <h2>We can't find the job you were looking for</h2>
                <p>Please check the link you provided</p>
                <button class="btn btn-primary" [routerLink]="['/home']">
                  RETURN TO HOMEPAGE
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="container job-detail-container" *ngIf="!job && !loading">
        <div class="card p-30 job-detail-card">
          <div class="container">
            <div class="row">
              <div class="col-12 text-center">
                <h2>We can't find the job you were looking for</h2>
                <p>Please check the link you provided</p>
                <button class="btn btn-primary" [routerLink]="['/home']">
                  RETURN TO HOMEPAGE
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>
</main>
<!-- Modals -->
<div id="shareModal" class="modal fade" *ngIf="job && canSee" role="dialog">
  <div class="modal-dialog border-none">
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header text-center border-none">
        <div class="col-12">
          <h5 class="modal-title">SHARE THIS JOB AS A LINK</h5>
        </div>
        <button
          type="button"
          class="close"
          style="position: absolute; right: 15px"
          data-dismiss="modal"
        >
          &times;
        </button>
      </div>
      <div class="modal-body border-none">
        <div class="container">
          <div class="row">
            <div class="col-12">
              <div class="row px-15"></div>
              <div class="row px-15">
                <div class="col-12 text-center">
                  <span>URL:</span>
                  <br />
                  <br />
                  <p class="link-col p-10">
                    {{ link }}
                  </p>
                  <button (click)="copyLink()" class="btn btn-primary mt-5">
                    COPY LINK
                  </button>
                </div>
              </div>
              <div class="row">
                <div class="col-12 text-center">
                  <small id="copied">Copied!</small>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div
  id="bidModal"
  *ngIf="job && currentUser && currentUser.type === 'Provider'"
  class="modal fade"
  role="dialog"
>
  <div class="modal-dialog border-none">
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header text-center border-none">
        <div class="col-12">
          <h5 class="modal-title">PLACE YOUR BID</h5>
        </div>
        <button
          type="button"
          class="close"
          style="position: absolute; right: 15px"
          id="close-bid"
          data-dismiss="modal"
        >
          &times;
        </button>
      </div>
      <div class="modal-body border-none">
        <div class="container" *ngIf="canBid && !sent">
          <div class="row">
            <div class="col-12">
              <form [formGroup]="bidForm" class="form validate" novalidate>
                <label for="price">Price*</label>
                <br />
                <div class="input-group" style="border: none">
                  <input
                    type="number"
                    formControlName="price"
                    style="border: 1px solid #ebebeb"
                    class="form-control"
                    id="price"
                    placeholder="Client budget : {{ job.budget }}"
                  />
                  <div class="input-group-append" style="padding: 5px">
                    <span class="input-group-text">
                      <span *ngIf="job.paymentType !== 'Fixed price'">/hr </span
                      >USD</span
                    >
                  </div>
                </div>
                <label for="message">Message</label>
                <br />
                <textarea
                  rows="2"
                  class="form-control"
                  placeholder="Deliver your pitch!"
                  formControlName="message"
                  id="message"
                ></textarea>
              </form>
              <div class="row px-15"></div>
            </div>
          </div>
        </div>
        <div class="container" *ngIf="!canBid && sent">
          <div class="row">
            <div class="col-12 text-center">
              <img
                src="assets/img/CanYa_tick_green.svg"
                class="mb-30 fadeInShort"
                width="100px"
                height="100px"
              />
              <h6>Bid posted!</h6>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer text-right" *ngIf="canBid && !sent">
        <img
          src="assets/img/loader.svg"
          style="height: 36px"
          alt="Loader"
          *ngIf="isBidding"
        />
        <button
          type="button"
          class="btn btn-primary"
          [disabled]="!bidForm.valid || isBidding"
          (click)="submitBid()"
        >
          PLACE BID
        </button>
      </div>
    </div>
  </div>
</div>
